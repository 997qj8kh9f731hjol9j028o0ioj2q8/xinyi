local Hooked = {}


setthreadidentity(2)
for i, v in getgc(true) do
	if ( typeof(v) == 'table' ) then
		local DetectFunc = rawget(v, 'Detected')
		local KillFunc = rawget(v, 'Kill')
		if ( typeof(DetectFunc) == 'function' and not Detected ) then
			Detected = DetectFunc
			local Old; Old = hookfunction(Detected, function(Action, Info, NoCrash)
				if ( Action ~= '_' ) then
				end
				return true
			end)
			table.insert(Hooked, Detected)
		end
		if ( rawget(v, 'Variables') and rawget(v, 'Process') and typeof(KillFunc) == 'function' and not Kill ) then
			Kill = KillFunc
			local Old; Old = hookfunction(Kill, function(Info)
			end)
			table.insert(Hooked, Kill)
		end
	end
end
local Old; Old = hookfunction(getrenv().debug.info, (function(...)
	local LevelOrFunc, Info = ...
	if ( Detected and LevelOrFunc == Detected ) then
		return coroutine.yield(coroutine.running())
	end
	return Old(...)
end))
setthreadidentity(7)

task.spawn(function()
	repeat wait() until game:IsLoaded()

	local Amplitude = 200
	local RandomValue = {-200,200}
	local RandomTime = {.1, 1}

	local floor = math.floor
	local cos = math.cos
	local sin = math.sin
	local acos = math.acos
	local pi = math.pi

	local Maxima = 0

	while wait() do
		if gcinfo() >= Maxima then
			Maxima = gcinfo()
		else
			break
		end
	end

	wait(0.30)

	local OldGcInfo = gcinfo()+Amplitude
	local tick = 0

	function getreturn()
		local Formula = ((acos(cos(pi * (tick)))/pi * (Amplitude * 2)) + -Amplitude )
		return floor(OldGcInfo + Formula);
	end

	local Old; Old = hookfunction(getrenv().gcinfo, function(...)
		return getreturn();
	end)
	local Old2; Old2 = hookfunction(getrenv().collectgarbage, function(arg, ...)
		local suc, err = pcall(Old2, arg, ...)
		if suc and arg == "count" then
			return getreturn();
		end
		return Old2(arg, ...);
	end)

	Connection[RandomString] = RunService.Stepped:Connect(function()
		local Formula = ((acos(cos(pi * (tick)))/pi * (Amplitude * 2)) + -Amplitude )
		if Formula > ((acos(cos(pi * (tick)+.01))/pi * (Amplitude * 2)) + -Amplitude ) then
			tick = tick + .07
		else
			tick = tick + 0.01
		end
	end)

	local old1 = Amplitude
	for i,v in next, RandomTime do
		RandomTime[i] = v * 10000
	end

	local RandomTimeValue = math.random(RandomTime[1],RandomTime[2])/10000

	while wait(RandomTime) do
		Amplitude = math.random(old1+RandomValue[1], old1+RandomValue[2])
		RandomTimeValue = math.random(RandomTime[1],RandomTime[2])/10000
	end
end)

task.spawn(function()
	repeat wait() until game:IsLoaded()

	local CurrMem = Stats:GetTotalMemoryUsageMb();
	local Rand = 0

	Connection[RandomString] = RunService.Stepped:Connect(function()
		local random = math.random
		Rand = random(-10, 10);
	end)

	function GetReturn()
		return CurrMem + Rand;
	end

	local _MemBypass
	_MemBypass = hookmetamethod(game, "__namecall", (function(self,...)
		local method = getnamecallmethod();

		if not checkcaller() then
			if typeof(self) == "Instance" and (method == "GetTotalMemoryUsageMb" or method == "getTotalMemoryUsageMb") and self.ClassName == "Stats" then
				return GetReturn();
			end
		end

		return _MemBypass(self,...)
	end))

	local _MemBypassIndex; _MemBypassIndex = hookfunction(Stats.GetTotalMemoryUsageMb, (function(self, ...)
		if not checkcaller() then
			if typeof(self) == "Instance" and self.ClassName == "Stats" then
				return GetReturn();
			end
		end
	end))
end)

task.spawn(function()
	repeat wait() until game:IsLoaded()

	local CurrMem = Stats:GetMemoryUsageMbForTag(Enum.DeveloperMemoryTag.Gui);
	local Rand = 0

	Connection[RandomString] = RunService.Stepped:Connect(function()
		local random = math.random
		Rand = random(-0.1, 0.1);
	end)

	function GetReturn()
		return CurrMem + Rand;
	end

	local _MemBypass
	_MemBypass = hookmetamethod(game, "__namecall", (function(self,...)
		local method = getnamecallmethod();

		if not checkcaller() then
			if typeof(self) == "Instance" and (method == "GetMemoryUsageMbForTag" or method == "getMemoryUsageMbForTag") and self.ClassName == "Stats" then
				return GetReturn();
			end
		end

		return _MemBypass(self,...)
	end))

	local _MemBypassIndex; _MemBypassIndex = hookfunction(Stats.GetMemoryUsageMbForTag, (function(self, ...)
		if not checkcaller() then
			if typeof(self) == "Instance" and self.ClassName == "Stats" then
				return GetReturn();
			end
		end
	end))
end)

local ContentProviderBypass
ContentProviderBypass = hookmetamethod(game, "__namecall", (function(self, Instances, ...)
	local method = getnamecallmethod();
	local args = ...;

	if not checkcaller() and (method == "preloadAsync" or method == "PreloadAsync") then
		if Instances and Instances[1] and self.ClassName == "ContentProvider" then
			if Instances ~= nil then
				if typeof(Instances[1]) == "Instance" and (table.find(Instances, CoreGui) or table.find(Instances, game)) then
					if Instances[1] == CoreGui then
						randomizedCoreGuiTable = randomizeTable(coreguiTable)
						return ContentProviderBypass(self, randomizedCoreGuiTable, ...)
					end

					if Instances[1] == game then
						randomizedGameTable = randomizeTable(gameTable)
						return ContentProviderBypass(self, randomizedGameTable, ...)
					end
				end
			end
		end
	end

	return ContentProviderBypass(self, Instances, ...)
end))
